================================================================================
                    SEARCH FLOW DIAGRAM: q=baggage&type=semantic&index=contracts
================================================================================

USER INTERFACE
==============

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                     SEARCH INPUT                            â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚ ğŸ” [baggage_____________________________] [SEARCH]   â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                                             â”‚
    â”‚  Mode Selector: [Keyword] [Semantic*] [AI Agent]          â”‚
    â”‚                                                             â”‚
    â”‚  Sidebar Filters:                                          â”‚
    â”‚  â”Œâ”€ Authors â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
    â”‚  â”‚ â€¢ Policy Team (15)        â”‚                            â”‚
    â”‚  â”‚ â€¢ Legal Dept (8)          â”‚                            â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ performSearch()
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FRONTEND (app.js)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  1. Collect request parameters:                                 â”‚
â”‚     {                                                            â”‚
â”‚       "query": "baggage",                                        â”‚
â”‚       "type": "semantic",                                        â”‚
â”‚       "index": "contracts",                                      â”‚
â”‚       "filters": {}  // or {"author": "Policy Team"}            â”‚
â”‚     }                                                            â”‚
â”‚                                                                   â”‚
â”‚  2. POST /api/search with JSON body                             â”‚
â”‚     (URL also updated: ?q=baggage&type=semantic&index=contracts)â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â”‚ HTTP POST
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BACKEND (app.py)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  @route('/api/search', methods=['POST'])                        â”‚
â”‚  def search():                                                  â”‚
â”‚      type = 'semantic'                                          â”‚
â”‚      query = 'baggage'                                          â”‚
â”‚      index = 'contracts'                                        â”‚
â”‚                                                                   â”‚
â”‚      â†“                                                            â”‚
â”‚      search_contracts(query, type, size=20, filters={})         â”‚
â”‚      â†“                                                            â”‚
â”‚      semantic_search(query='baggage', size=20, filters={})      â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â”‚ Build Elasticsearch Query
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ELASTICSEARCH QUERY BUILDER (app.py)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  query_clause = {                                               â”‚
â”‚    "semantic": {                                                â”‚
â”‚      "field": "semantic_content",                              â”‚
â”‚      "query": "baggage"                                         â”‚
â”‚    }                                                             â”‚
â”‚  }                                                               â”‚
â”‚                                                                   â”‚
â”‚  body = {                                                        â”‚
â”‚    "query": query_clause,                                       â”‚
â”‚    "size": 20,                                                  â”‚
â”‚    "_source": ["filename", "attachment.*", "upload_date"],     â”‚
â”‚    "highlight": {                                               â”‚
â”‚      "fields": {                                                â”‚
â”‚        "semantic_content": {                                    â”‚
â”‚          "type": "semantic",                                    â”‚
â”‚          "number_of_fragments": 3,                              â”‚
â”‚          "fragment_size": 150                                   â”‚
â”‚        }                                                         â”‚
â”‚      }                                                           â”‚
â”‚    },                                                            â”‚
â”‚    "aggs": {                                                     â”‚
â”‚      "authors": { "terms": {...} },                             â”‚
â”‚      "upload_years": { "date_histogram": {...} }                â”‚
â”‚    }                                                             â”‚
â”‚  }                                                               â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â”‚ POST /contracts/_search
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       ELASTICSEARCH                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  POST /contracts/_search                                        â”‚
â”‚  {                                                               â”‚
â”‚    "query": {                                                   â”‚
â”‚      "semantic": {                                              â”‚
â”‚        "field": "semantic_content",                             â”‚
â”‚        "query": "baggage"                                       â”‚
â”‚      }                                                           â”‚
â”‚    },                                                            â”‚
â”‚    ...                                                           â”‚
â”‚  }                                                               â”‚
â”‚                                                                   â”‚
â”‚  â†“ (Semantic Embedding Search)                                 â”‚
â”‚                                                                   â”‚
â”‚  Returns 20 matching documents with:                            â”‚
â”‚  - _source: Document fields                                     â”‚
â”‚  - _score: Relevance score                                      â”‚
â”‚  - highlight.semantic_content: [                                â”‚
â”‚      "All passengers are permitted one <em>baggage</em> item..",â”‚
â”‚      "Additional <em>baggage</em> fees apply..",                â”‚
â”‚      "Oversized <em>baggage</em> requires special handling.."   â”‚
â”‚    ]                                                             â”‚
â”‚  - aggregations: Author and year facets                         â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â”‚ JSON Response
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              RESPONSE PROCESSING (app.py)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  {                                                               â”‚
â”‚    "hits": {                                                    â”‚
â”‚      "total": {"value": 42, "relation": "eq"},                  â”‚
â”‚      "hits": [                                                  â”‚
â”‚        {                                                         â”‚
â”‚          "_index": "contracts",                                 â”‚
â”‚          "_source": {                                           â”‚
â”‚            "filename": "flight_policy_2023.pdf",                â”‚
â”‚            "attachment": {                                      â”‚
â”‚              "title": "Flight Baggage Policy",                  â”‚
â”‚              "content": "All passengers are...",                â”‚
â”‚              "author": "Policy Team"                            â”‚
â”‚            }                                                     â”‚
â”‚          },                                                      â”‚
â”‚          "highlight": {                                         â”‚
â”‚            "semantic_content": [                                â”‚
â”‚              "permitted one <em>baggage</em> item..",           â”‚
â”‚              "<em>baggage</em> fees apply.."                    â”‚
â”‚            ]                                                     â”‚
â”‚          }                                                       â”‚
â”‚        },                                                        â”‚
â”‚        ...                                                       â”‚
â”‚      ]                                                           â”‚
â”‚    },                                                            â”‚
â”‚    "aggregations": { ... }                                      â”‚
â”‚  }                                                               â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â”‚ HTTP 200 JSON
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          RESULT RENDERING (app.js displayResults)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  For each hit:                                                  â”‚
â”‚    1. Extract source: {filename, title, author, content}       â”‚
â”‚    2. Extract highlight: hit.highlight.semantic_content[]       â”‚
â”‚    3. Process snippets:                                         â”‚
â”‚       - Replace <em> tags with <mark class="result-highlight">  â”‚
â”‚       - Join multiple fragments with " ... "                    â”‚
â”‚    4. Build metadata: {upload_date, author}                     â”‚
â”‚    5. Create HTML:                                              â”‚
â”‚                                                                   â”‚
â”‚       <div class="result-item result-item-contracts">           â”‚
â”‚         <h6>                                                     â”‚
â”‚           <i class="bi bi-file-earmark-text"></i>              â”‚
â”‚           Flight Baggage Policy                                 â”‚
â”‚         </h6>                                                    â”‚
â”‚         <p class="small">                                        â”‚
â”‚           All passengers are permitted one                      â”‚
â”‚           <mark class="result-highlight">baggage</mark>         â”‚
â”‚           item... Additional <mark class="result-highlight">    â”‚
â”‚           baggage</mark> fees apply...                          â”‚
â”‚         </p>                                                     â”‚
â”‚         <small class="text-muted">                              â”‚
â”‚           <i class="bi bi-calendar3"></i>Uploaded: 1/15/2023   â”‚
â”‚           <i class="bi bi-person"></i>Author: Policy Team       â”‚
â”‚         </small>                                                 â”‚
â”‚       </div>                                                     â”‚
â”‚                                                                   â”‚
â”‚  Display facets in sidebar:                                     â”‚
â”‚    - Authors (with count filter)                                â”‚
â”‚    - Upload Years (with count filter)                           â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â”‚ Inject into DOM
                                  â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚  DISPLAYED PAGE  â”‚
                            â”‚                  â”‚
                            â”‚  Results with:   â”‚
                            â”‚  âœ“ Titles        â”‚
                            â”‚  âœ“ Snippets      â”‚
                            â”‚  âœ“ Highlighted   â”‚
                            â”‚    matches       â”‚
                            â”‚  âœ“ Metadata      â”‚
                            â”‚  âœ“ Filters       â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

================================================================================
                              SNIPPET EXTRACTION DETAIL
================================================================================

Input: Elasticsearch Response
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ {                                                       â”‚
â”‚   "highlight": {                                        â”‚
â”‚     "semantic_content": [                               â”‚
â”‚       "permitted one <em>baggage</em> item..",          â”‚
â”‚       "<em>baggage</em> fees apply..",                  â”‚
â”‚       "special <em>baggage</em> handling.."             â”‚
â”‚     ]                                                    â”‚
â”‚   }                                                     â”‚
â”‚ }                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼ (app.js line 306)
                 Extract snippets
                       â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                     â”‚
            â–¼ (try 1)             â–¼ (try 2)
   highlight exists      fallback to source
            â”‚                     â”‚
            â–¼                     â–¼
        snippets[] â† â† â† â† source.attachment.content
            â”‚
            â–¼ (app.js line 327-334)
    Process each snippet:
    snippet.replace(/<em>/g, '<mark class="result-highlight">')
    snippet.replace(/<\/em>/g, '</mark>')
            â”‚
            â–¼
  Join with ' ... ':
  "permitted one <mark>baggage</mark> item... <mark>baggage</mark> fees apply..."
            â”‚
            â–¼
    <p class="small">${snippetHtml}</p>
            â”‚
            â–¼
Output: Displayed snippet with highlighted terms

================================================================================
                           STYLING APPLIED
================================================================================

CSS (style.css lines 92-103):

.result-highlight {
    background: #fef08a;        â† Yellow highlight
    padding: 2px 4px;
    font-weight: 600;           â† Bold text
    border-radius: 3px;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}

[data-bs-theme="dark"] .result-highlight {
    background: #854d0e;        â† Dark brown background
    color: #fef08a;             â† Yellow text
}

Result in browser:
    permitted one [baggage] item... [baggage] fees apply...
                  â””â”€ yellow bg, bold, rounded â”€â”˜

================================================================================
